
# Elements of Data Analysis in 1D
# and 2D FTICR-MS data

*Marc-André Delsuc - 2nd Advanced User School, Prague, Sept 2021*

---

The presentation will cover the various aspects that appear when processing and analyzing FT-ICR experiment on the point of view of the signal. It will be divided into several parts, covering the different experimental approached.

This text as well as the slides presented during the meeting is available under a CC BY-SA licence at `github.com/delsuc/2nd-AUS-FTICR`


## The Fourier Transform - the basic aspects
Central to the data processing and to the analysis, the fundamentals of the Fourier Transform are rapidly presented, with an emphasis on the practical aspects rather than the theoretical ones.
In its more basic aspects, the signal acquired during a FT-ICR experiment is the variation of the tension measured on the detection plates of the FT-ICR cell, and represented as regularly sampled time series in the instrument computer system.
We cover the basic principles used to analyze this signal, in terms of spectral analysis, frequency and evolution.
The convolution theorem is introduced and used to comprehend various aspects of resolution limits and line shapes.

The constraints on the sampling rate, the total acquisition time and the total number of points are deeply related, and we show how the experimental condition impact the spectral width, the repetition time and the spectral resolution, we also introduce the Nyquist-Shannon theorem.
Some of these relationships can be seen as a specific form of the uncertainty principle and are generalized under the name of the Gabor Limit.

The numerical aspects of the processing are also covered, with the basic principles of the Digital Fourier Transform, its algebraic form, and the algorithmic used for its implementation.


## The FTICR experiment
In a second part the real FTICR experiment is considered, and we see how the theoretical aspects impact the way the data are actually handled.

The details of the shape of the signal after Fourier Transform depends on the different options for the various steps performed during the processing.
In particular the apodisation and zero-filling, which consist in preprocessing the transient data before the Fourier Transformation itself have a strong impact on the line-shape, the resolution and the Signal-to-Noise Ratio (SNR).
The different possible strategies are presented and discussed.

The measured spectrum is represented as complex quantities due to the very nature of the Fourier Transform.
Relationships between the real and imaginary parts of the complex signal generate absorptive and dispersive line-shapes.
Both have very different line-shapes, and are generally mixed in the spectrum.
This mixing degrades the theoretical maximal resolution. 
A detailed knowledge of the excitation pulse allows to isolate the absorptive line-shape by applying a phase correction which generate spectra with a higher resolution.
Handling of the phase over the whole spectrum allows to generate absorption spectra, where only the absorptive shape is displayed, presenting possible important gain in resolution and SNR, but requiring alternative processing procedures.
The details of the phasing procedure, and the various strategies to solve the problem are presented, depending on the experimental chosen set-up (1st or 2nd order correction, narrow-band vs broad-band spectra, ...)

The details of the excitation pulse which initiate the orbit of the ions have a strong impact on the signal.
While the complete study is outside this course, the relation to the intensity and phase of the signal is demonstrated.
In particular, the reciprocity theorem 
^[*The reciprocity theorem can be stated as that the fields generated by sources 2 as “measured” by sources 1 is equal to fields generated by sources 1 as “measured” by sources 2. - Weng Cho Chew Purdue Univ.*]
and the linearity of the physics of the ion packet,
allow to apply the Fourier theory to the pulse pattern in order to estimate its impact on the final spectrum.
This can be used to generate specific patterns in the excitation spectrum, but also to control the phase of the excited signal.
Example of these procedures are presented.

In extension, the dynamic of the ion clouds orbiting in the cell is presented through its impact on the final spectrum, and how this dynamic can be handled.
Short frequency fluctuations of the ions generate a loss of resolution, but their detailed analysis can be performed.
This analysis seems contradictory to the uncertainty principle, but can be understood with a finer analysis of the underlying assumptions.
Several strategies are presented.


## more complex experiments
More complex experiments can be handled with the same principles, however specific problems arise and should be considered.

These data analysis principles can be applied to more complex experiments, and two 
such as time-resolved MS of 2D-MS.
However in terms of software implementation, some decisions have to be made in order to be able to handle efficiently this kind of experiments.
Different possibilities are considered and put into perspective of their respective efficiency in terms of data access, visualization or storage burden.

2D-MS is a special case, as a spectral analysis has to be performed along the time-solved axis as well as along the classical spectral axis.
In a 2D FT-ICR MS experiment, a periodic signal is measured along the non-classical axis, and a standard processing can easily be performed, provided the data-set has been acquired in correct conditions.
Indeed, the Nyquist condition or the basic processing approaches are strictly equivalent to their classical counterparts.
However many differences appear when implementing such experiments.
The $S(t_1) \propto \sqrt{1+\cos(\omega_1 t_1)}$ relationship found in 2D FTICR, creates many harmonics and the spectrometer electronics adds additional frequency shift in the process, however both difficulties can be overcome.

Finally, 2D modulation introduces new degree of freedoms, that complex numbers are unable to handle, in particular for doubly causal experiments such as 2D FTICR-MS.
In consequence, an algebra generalizing complex numbers, namely the hypercomplex algebra, has to be used to fully describe the acquired signal.
This approach has already been fully developed for nD NMR, and has to be applied in 2D-MS as well.
Finally, phase properties of the 2D signal are explored, and differences between the classical and non-classical axes are explored.
Examples of phased and dephased spectra are considered, and phasing a 2D FT-ICR MS experiment is shown.



<!--
## The Fourier Transform - the basic aspects

- time / freq
    - spectral analysis
    - point of view
    - instantaneity / global property
    - time varying / freq varying / FTICR
- fundamental equation
    - basic
    - time / frequency domains
        - != point of views
    - complex numbers, Euler notation 
- basic properties
    - compaction theorem
    - perceval
    - $S_o  F_o$
- FT - DFT - FFT
    - analytic - numeric
    - DFT
    - nth root of 1
    - FFT
- DFT / FT differences
    - frequency bounded signal
    - Nyquist relation
    - filtering
    - $S_o  F_o$
    - $t_{max} \Delta F$ / $F_{max} \Delta t$ / $N$
- convolution
    - rapidly
    - periodisation / sampling - link with convolution
    - 


## The FTICR experiment

- classical processing
    - acqu - centering - apod - zf - modulus
    - definition and measure of resolution
    - comparing strategies
- complex: real / imaginary
    - and time/freq asymmetry
    - fft - rfft - fftr
    - causal signal
    - KK
    - Hilbert transform
- phase
    - phase one signal in the time domain
    - phase complete spectrum
    - effect of the pulse
        - narrow band spectra
        - 1st order correction
    - broad band spectra
        - 2nd order correction
        - Kilgour
        - MAD manual
- Gabor theorem
    - link with convolution
    - assumptions / limitations
- ion cloud dynamic
    - and line-shape
    - instantaneous freq
        - FT
        - FDM
        - FISTA
        - ...
    - and excitation
        - quadratic phase dependence


## more complex experiments

### time resolved MS
- peak storage / data storage
- 2D storage
    - hdf5
    - compression
- space charge effect
- recalibration

### 2D
- basic principle
    - sampling, Nyquist, processing 
- but
    - $S(t_1) \propto \sqrt{1+\cos(\omega_1 t_1)}$
    - Maria puzzle
    - FT of $S(t_1)$
        - harmonics
        - fragmentation optimization
    - freq generator continuous phase 
- difference in F1 and F2
    - Nyquists
    - band limited
- causality in 2D
    - hypercomplex algebra.
- phasing
    - F2 is 2nd order
    - F1 is 1st order
- NUS
    - FISTA -we've seen it

-->

```python

```
